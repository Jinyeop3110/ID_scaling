import gc
import os
from accelerate import Accelerator
import sys
from fancy_einsum import einsum

import transformer_lens.utils as utils
from transformer_lens.hook_points import (
    HookPoint,
)  # Hooking utilities
from transformers import AutoTokenizer, pipeline, logging, AutoModelForCausalLM, AutoConfig
from transformer_lens import ActivationCache, HookedTransformer

from huggingface_hub import notebook_login
from datasets import Dataset
import pandas as pd
import transformers
import torch
import einops  # Make sure einops is imported
import numpy as np 

from neel_plotly import line, imshow, scatter
import transformer_lens.patching as patching
import circuitsvis as cv
import matplotlib.pyplot as plt
from pathlib import Path


from ML_JY.ID_scaling.utils.load_Dataset import load_Datasets
from utils.load_Model import load_Model
from utils.utils import *
import json
import argparse
import concurrent.futures
import time

def print_max_gpu_memory():
    print(f"Max GPU memory allocated: {torch.cuda.max_memory_allocated() / 1024 ** 3:.2f} GB")
    print(f"Max GPU memory reserved: {torch.cuda.max_memory_reserved() / 1024 ** 3:.2f} GB")


if False : 
    from transformers import AutoModelForSequenceClassification, AutoTokenizer
    from accelerate import Accelerator
    import torch
    #accelerator = Accelerator(mixed_precision='fp16')
    #accelerator.device

    print("***Case : w accelerator")
    accelerator = Accelerator(mixed_precision='fp16') 
    model, tokenizer = load_Model("olmo-1b", checkpoint=None)
    # Prepare the model and tokenizer with the accelerator
    model = accelerator.prepare(model)
    model.eval()

    # Tokenize input
    input_text = ["This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home."] * 10
    inputs = tokenizer(input_text, return_tensors="pt", padding=True, truncation=True)

    # Move inputs to the appropriate device
    inputs = {k: v.to(accelerator.device) for k, v in inputs.items() if k != 'token_type_ids'}

    start_time = time.time()  # Start time before forward pass

    # Perform inference
    #with torch.cuda.amp.autocast():
    with torch.no_grad():
        outputs = model(**inputs)

    # Retrieve logits
    logits = outputs.logits

    # Convert logits to probabilities (optional)
    #probs = torch.softmax(logits, dim=-1)

    # Print probabilities and the data type of the logits
    #print(probs)
    print(f'Output dtype: {logits.dtype}')
    print_max_gpu_memory()
    end_time = time.time()  # Start time before forward pass
    print(f"Time taken for the forward pass: {end_time - start_time:.4f} seconds")

'''
print("***Case : w accelerator")
Max GPU memory allocated: 26.55 GB
Max GPU memory reserved: 27.22 GB
Time taken for the forward pass: 0.6609 seconds
'''

if True : 

    from transformers import AutoModelForSequenceClassification, AutoTokenizer
    from accelerate import Accelerator
    import torch
    #accelerator = Accelerator(mixed_precision='fp16')
    #accelerator.device

    print("***Case : wo accelerator")
    accelerator = Accelerator(mixed_precision='fp16') 
    model, tokenizer = load_Model("olmo-1b", checkpoint=None)
    # Prepare the model and tokenizer with the accelerator
    model.cuda()
    model.eval()

    # Tokenize input
    input_text = ["This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home."] * 10
    inputs = tokenizer(input_text, return_tensors="pt", padding=True, truncation=True)

    # Move inputs to the appropriate device
    inputs = {k: v.to(model.device) for k, v in inputs.items() if k != 'token_type_ids'}

    start_time = time.time()  # Start time before forward pass

    # Perform inference
    #with torch.cuda.amp.autocast():
    with torch.no_grad():
        outputs = model(**inputs)

    # Retrieve logits
    logits = outputs.logits

    # Convert logits to probabilities (optional)
    #probs = torch.softmax(logits, dim=-1)

    # Print probabilities and the data type of the logits
    #print(probs)
    print(f'Output dtype: {logits.dtype}')
    print_max_gpu_memory()
    end_time = time.time()  # Start time before forward pass
    print(f"Time taken for the forward pass: {end_time - start_time:.4f} seconds")

'''
print("***Case : wo accelerator")
Max GPU memory allocated: 28.80 GB
Max GPU memory reserved: 30.66 GB
Time taken for the forward pass: 9.6424 seconds
'''

if False : 

    from transformers import AutoModelForSequenceClassification, AutoTokenizer
    from accelerate import Accelerator
    import torch
    #accelerator = Accelerator(mixed_precision='fp16')
    #accelerator.device

    print("***Case : wo accelerator, model.half()")
    accelerator = Accelerator(mixed_precision='fp16') 
    model, tokenizer = load_Model("olmo-1b", checkpoint=None)
    # Prepare the model and tokenizer with the accelerator
    model.half()
    model.cuda()
    model.eval()

    # Tokenize input
    input_text = ["This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home."] * 10
    inputs = tokenizer(input_text, return_tensors="pt", padding=True, truncation=True)

    # Move inputs to the appropriate device
    inputs = {k: v.to(model.device) for k, v in inputs.items() if k != 'token_type_ids'}

    start_time = time.time()  # Start time before forward pass

    # Perform inference
    #with torch.cuda.amp.autocast():
    with torch.no_grad():
        outputs = model(**inputs)

    # Retrieve logits
    logits = outputs.logits

    # Convert logits to probabilities (optional)
    #probs = torch.softmax(logits, dim=-1)

    # Print probabilities and the data type of the logits
    #print(probs)
    print(f'Output dtype: {logits.dtype}')
    print_max_gpu_memory()
    end_time = time.time()  # Start time before forward pass
    print(f"Time taken for the forward pass: {end_time - start_time:.4f} seconds")

'''
print("***Case : wo accelerator, model.half()")
Max GPU memory allocated: 14.79 GB
Max GPU memory reserved: 19.09 GB
Time taken for the forward pass: 0.6372 seconds
'''


if False : 

    from transformers import AutoModelForSequenceClassification, AutoTokenizer
    from accelerate import Accelerator
    import torch
    #accelerator = Accelerator(mixed_precision='fp16')
    #accelerator.device

    print("***Case : w accelerator, model.half()")
    accelerator = Accelerator(mixed_precision='fp16') 
    model, tokenizer = load_Model("olmo-1b", checkpoint=None)

    model.half()
    # Prepare the model and tokenizer with the accelerator
    model = accelerator.prepare(model)
    model.eval()

    # Tokenize input
    input_text = ["This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home.hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home. This is a test sentence. hahaha This is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahahaThis is a test sentence. hahaha. What is the best way to keep energy levels high throughout the day? Just look at the legendary Chuck Norris’s advice since he is now a whopping 81 years old and yet has MORE energy than me. He found a key to healthy aging… and it was by doing the opposite of what most of people are told. Norris says he started learning about this revolutionary new method when he noticed most of the supplements he was taking did little or nothing to support his health. After extensive research, he discovered he could create dramatic changes to his health simply focusing on 3 things that sabotage our body as we age. “This is the key to healthy aging,” says Norris. “I’m living proof.” Now, Chuck Norris has put the entire method into a 15-minute video that explains the 3 “Internal Enemies” that can wreck our health as we age, and the simple ways to help combat them, using foods and herbs you may even have at home."] * 10
    inputs = tokenizer(input_text, return_tensors="pt", padding=True, truncation=True)

    # Move inputs to the appropriate device
    inputs = {k: v.to(accelerator.device) for k, v in inputs.items() if k != 'token_type_ids'}

    start_time = time.time()  # Start time before forward pass

    # Perform inference
    #with torch.cuda.amp.autocast():
    with torch.no_grad():
        outputs = model(**inputs)

    # Retrieve logits
    logits = outputs.logits

    # Convert logits to probabilities (optional)
    #probs = torch.softmax(logits, dim=-1)

    # Print probabilities and the data type of the logits
    #print(probs)
    print(f'Output dtype: {logits.dtype}')
    print_max_gpu_memory()
    end_time = time.time()  # Start time before forward pass
    print(f"Time taken for the forward pass: {end_time - start_time:.4f} seconds")

'''
print("***Case : w accelerator, model.half()")
Max GPU memory allocated: 24.36 GB
Max GPU memory reserved: 25.18 GB
Time taken for the forward pass: 0.5464 seconds
'''